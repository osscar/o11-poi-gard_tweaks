<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <!-- Search Views -->

  <!-- Views -->
  <record id="view_order_form" model="ir.ui.view">
    <field name="name">view.order.form.inherit.gard_product_stock_qty</field>
    <field name="model">sale.order</field>
    <field name="mode">extension</field>
    <field name="priority">19</field>
    <field name="inherit_id" ref="sale.view_order_form" />
    <field name="arch" type="xml">

      <xpath expr="/form//field[@name='order_line']/tree//field[@name='route_id']" position="before">
        <button
          name="button_product_stock_quantity"
          string="Product Stock Quantity"
          attrs="{'invisible':[('qty_available', '&lt;', '1')]}"
          type="object"
          icon="fa-dropbox fa-gard-icon-orange fa-2x"
        />
        <field name="qty_available" />
      </xpath>

      <xpath expr="/form//field[@name='order_line']/form/group/group//field[@name='route_id']"
        position="before">
        <button
          name="button_product_stock_quantity"
          string="Product Stock Quantity"
          attrs="{'invisible':[('qty_available', '&lt;', '1')]}"
          type="object"
          icon="fa-dropbox fa-gard-icon-orange fa-2x"
        />
        <field name="qty_available" />
      </xpath>
  
      <xpath expr="//form//field[@name='order_line']//kanban//field[@name='product_uom_qty']"
        position="before">
        <div class="col-xs-4 pull-right">
          <button
          name="button_product_stock_quantity"
          string="Product Stock Quantity"
          attrs="{'invisible':[('qty_available', '&lt;', '1')]}"
          type="object"
          icon="fa-dropbox fa-gard-icon-orange fa"
        />/
        <field name="qty_available" />
        </div>
      </xpath>

    </field>
  </record>

  <record model="ir.ui.view" id="view_order_line_tree">
    <field name="name">sale.order.line.tree.inherit.gard_product_stock_qty</field>
    <field name="model">sale.order.line</field>
    <field name="mode">extension</field>
    <field name="priority">19</field>
    <field name="inherit_id" ref="sale.view_order_line_tree" />
    <field name="arch" type="xml">

      <!-- product stock qty button -->
      <xpath expr="//field[@name='route_id']" position="before">
        <button
          name="button_product_stock_quantity"
          string="Product Stock Quantity"
          attrs="{'invisible':[('qty_available', '&lt;', '1')]}"
          type="object"
          icon="fa-dropbox fa-gard-icon-orange fa-2x"
        />
        <field name="qty_available" />
      </xpath>
    </field>
  </record>

  <!-- Actions -->
  <record id="action_sale_product_stock_quantity_tree" model="ir.actions.act_window">
    <field name="name">Product Stock Quantity</field>
    <field name="type">ir.actions.act_window</field>
    <field name="res_model">stock.quant</field>
    <field name="view_id" ref="gard_product_stock_qty.view_sale_product_stock_quantity_tree" />
    <field name="view_mode">tree</field>
    <field name="context">{'group_by': ['location_id', 'product_id']}</field>
    <field name="domain">[('location_id.usage','=', 'internal')]</field>
    <field name="search_view_id" ref="gard_product_stock_qty.view_product_stock_quantity_search" />
  </record>

  <!-- Menus -->
  <menuitem
    id="menu_action_sale_product_stock_quantity_tree"
    name="Product Stock Quantity"
    parent="sale.product_menu_catalog"
    action="action_sale_product_stock_quantity_tree"
    sequence="20"
  />

</odoo>
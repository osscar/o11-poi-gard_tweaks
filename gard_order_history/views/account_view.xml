<?xml version="1.0"?>
<openerp>
    <data>

        <record id="invoice_tree" model="ir.ui.view">
            <field name="name">invoice.tree.inherit.gard_order_history</field>
            <field name="model">account.invoice</field>
            <field name="mode">extension</field>
            <field name="inherit_id" ref="account.invoice_tree"/>
            <field name="arch" type="xml">

                <xpath expr="//tree" position="attributes">
                    <attribute name="decoration-danger">(state in 'open') and (residual_signed &gt; 0) and (date_due &lt; current_date)</attribute>
                    <attribute name="decoration-danger">state not in ('paid','cancel') and estado_fac in 'A'</attribute>
                    <attribute name="decoration-success">state in 'paid' and estado_fac in 'V'</attribute>
                </xpath>

                <xpath expr="//tree/field[@name='state']" position="attributes">
                    <attribute name="widget">label_selection</attribute>
                    <attribute name="options">{
                        'classes': {
                            'draft': 'primary',
                            'none': 'danger',
                            'open': 'warning',
                            'paid': 'success',
                            'cancel': 'default'
                            }
                    }</attribute>
                </xpath>

                <xpath expr="//tree/field[@name='estado_fac']" position="attributes">
                    <attribute name="options">{
                        "bg_color": "
                            silver: state in 'paid' and estado_fac in 'A';
                            lightcoral: state not in ('paid','cancel') and estado_fac in 'A'
                            "
                    }</attribute>
                </xpath>

                <xpath expr="//tree/field[@name='residual_signed']" position="attributes">
                    <attribute name="options">{
                        "bg_color": "
                            lightcoral: (state in 'open') and (residual_signed &gt; 0) and (date_due &lt; current_date)
                            "
                    }</attribute>
                </xpath>

            </field>
        </record>

        <record id="invoice_supplier_tree" model="ir.ui.view">
            <field name="name">invoice.supplier.tree.inherit.gard_order_history</field>
            <field name="model">account.invoice</field>
            <field name="mode">extension</field>
            <field name="inherit_id" ref="account.invoice_supplier_tree"/>
            <field name="arch" type="xml">

                <xpath expr="//tree/field[@name='state']" position="after">
                    <field name="estado_fac"/>
                </xpath>

                <xpath expr="//tree" position="attributes">
                    <attribute name="decoration-danger">(state in 'open') and (residual_signed &gt; 0) and (date_due &lt; current_date)</attribute>
                    <attribute name="decoration-danger">state not in ('paid','cancel') and estado_fac in 'A'</attribute>
                    <attribute name="decoration-success">state in 'paid' and estado_fac in 'V'</attribute>
                </xpath>

                <xpath expr="//tree/field[@name='state']" position="attributes">
                    <attribute name="widget">label_selection</attribute>
                    <attribute name="options">{
                        'classes': {
                            'draft': 'primary',
                            'none': 'danger',
                            'open': 'warning',
                            'paid': 'success',
                            'cancel': 'default'
                            },
                    }</attribute>

                </xpath>

                <xpath expr="//tree/field[@name='estado_fac']" position="attributes">
                    <attribute name="options">{
                        "bg_color": "
                            silver: state in 'paid' and estado_fac in 'A';
                            lightcoral: state not in ('paid','cancel') and estado_fac in 'A'
                            "
                    }</attribute>
                </xpath>

                <xpath expr="//tree/field[@name='residual_signed']" position="attributes">
                    <attribute name="options">{
                        "bg_color": "
                            lightcoral: (state in 'open') and (residual_signed &gt; 0) and (date_due &lt; current_date)
                            "
                    }</attribute>
                </xpath>

            </field>
        </record>

        <record id="view_invoice_tree" model="ir.ui.view">
            <field name="name">invoice.tree.gard_order_history</field>
            <field name="model">account.invoice</field>
            <field name="view_mode">tree</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">

                <tree decoration-danger="state in 'open' and (residual_signed &gt; 0) and date_due &lt; current_date" decoration-success="state == 'paid'" string="Invoices">
                    <field name="state" widget="label_selection"
                        options="{
                            'classes': {
                                'draft': 'primary',
                                'none': 'danger',
                                'open': 'warning',
                                'paid': 'success',
                                'cancel': 'default'
                                }}"/>
                    <field name="estado_fac"/>
                    <field name="date_due"/>
                    <field name="date_invoice"/>
                    <field name="number"/>
                    <field name="cc_nro"/>
                    <field name="origin"/>
                    <field name="partner_id"/>
                    <field name="currency_id"/>
                    <field name="residual_signed"/>
                    <field name="amount_total_signed"/>
                    <field name="payment_ids" widget="many2many_tags"/>
                </tree>

            </field>
        </record>

        <!-- TO DO: had to inherit custom view to xpath and extend options' attributes to colorize fields -->
        <!-- optimally this should be added in primary view -->
        <!-- but the JSON syntax doesn't bode well with conditions against field values -->
        <record id="view_invoice_tree_inherit" model="ir.ui.view">
            <field name="name">invoice.tree.inherit.gard_order_history</field>
            <field name="model">account.invoice</field>
            <field name="mode">extension</field>
            <field name="inherit_id" ref="gard_order_history.view_invoice_tree"/>
            <field name="arch" type="xml">

                <xpath expr="//tree/field[@name='estado_fac']" position="attributes">
                    <attribute name="options">{
                        "bg_color": "
                            silver: state in 'paid' and estado_fac in 'A';
                            lightcoral: state not in ('paid','cancel') and estado_fac in 'A'
                            "
                    }</attribute>
                </xpath>

                <xpath expr="//tree/field[@name='residual_signed']" position="attributes">
                    <attribute name="options">{
                        "bg_color": "
                            lightcoral: (state in 'open') and (residual_signed &gt; 0) and (date_due &lt; current_date)
                            "
                    }</attribute>
                </xpath>

            </field>
        </record>

        <record id="view_account_payment_tree" model="ir.ui.view">
            <field name="name">account.payment.tree.gard_order_history</field>
            <field name="model">account.payment</field>
            <field name="view_mode">tree</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">

                <tree decoration-info="state=='draft'" decoration-muted="state=='reconciled'" edit="false">
                    <field name="state" widget="label_selection"
                        options="{
                            'classes': {
                                'draft': 'primary',
                                'open': 'warning',
                                'posted': 'success',
                                'reconciled': 'success',
                                'cancel': 'default'
                                }}"/>
                    <field name="payment_date"/>
                    <field name="partner_id" string="Partner"/>
                    <field name="name"/>
                    <field name="journal_id"/>
                    <field name="payment_method_id"/>
                    <field name="amount" sum="Amount"/>
                    <field name="communication"/>
                    <field name="transaction_number"/>
                    <field name="transaction_date"/>
                    <field name="currency_id" invisible="1"/>
                    <field name="partner_type" invisible="1"/>
                </tree>

            </field>
        </record>


    </data>
</openerp>

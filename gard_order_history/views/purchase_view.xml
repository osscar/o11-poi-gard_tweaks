<?xml version="1.0"?>
<openerp>
  <data>

    <record id="view_invoice_supplier_tree" model="ir.ui.view">
      <field name="name">invoice.supplier.tree.gard_order_history</field>
      <field name="model">account.invoice</field>
      <field name="view_mode">tree</field>
      <field name="type">tree</field>
      <field name="arch" type="xml">

        <tree decoration-danger="state in 'open' and (residual_signed &gt; 0) and date_due &lt; current_date" decoration-success="state == 'paid'" string="Invoices">
          <field
            name="state"
            widget="label_selection"
            options="{
                            'classes': {
                                'draft': 'primary',
                                'none': 'danger',
                                'open': 'warning',
                                'paid': 'success',
                                'cancel': 'default'
                                }}"/>
          <field name="estado_fac"/>
          <field name="date_due"/>
          <field name="date_invoice"/>
          <field name="reference"/>
          <field name="cc_nro"/>
          <field name="origin"/>
          <field name="partner_id"/>
          <field name="currency_id"/>
          <field name="residual_signed"/>
          <field name="amount_total_signed"/>
        </tree>

      </field>
    </record>

    <record id="purchase_order_form" model="ir.ui.view">
      <field name="name">purchase.order.form.inherit.gard_order_history</field>
      <field name="model">purchase.order</field>
      <field name="mode">extension</field>
      <field name="inherit_id" ref="purchase.purchase_order_form"/>
      <field name="arch" type="xml">

        <xpath expr="//notebook[last()]" position="inside">
          <page name="order_history" string="Order History">
            <separator colspan="4" string="Purchase Invoices"/>
            <field colspan="4" name="invoice_ids" readonly="1" nolabel="1" context="{'tree_view_ref': 'gard_order_history.view_invoice_supplier_tree', 'form_view_ref': 'account.invoice_supplier_form'}"/>
            <separator colspan="4" string="Cost Invoices"/>
            <field colspan="4" name="invoice_cost_ids" readonly="1"/>
            <separator colspan="4" string="Pickings"/>
            <field colspan="4" name="picking_ids" readonly="1" nolabel="1" widget="one2many_list" context="{'tree_view_ref': 'gard_order_history.stock_picking_view_tree'}"/>
            <separator colspan="4" string="Landed Costs"/>
            <field colspan="4" name="landed_cost_ids" readonly="1"/>
            <!-- nolabel="1" widget="one2many_list" context="{'tree_view_ref': 'gard_order_history.stock_picking_view_tree'}"/> -->
          </page>
          <page name="account_history" string="Accounting History">
            <group name="account_results">
              <group>
                <field name="balance_inv_stock_cost" readonly="1"/>
                <!-- <separator colspan="4" nolabel="1"/> -->
                <field name="balance_inv_am" readonly="1"/>
                <field name="balance_pick_am" readonly="1"/>
              </group>
              <group>
                <field name="balance_invc_lcost" readonly="1"/>
                <!-- <separator colspan="4" nolabel="1"/> -->
                <field name="balance_invc_am" readonly="1"/>
                <field name="balance_lcost_am" readonly="1"/>
              </group>
            </group>
            <separator colspan="4" string="Purchase Invoices Journal Entries"/>
            <field colspan="4" readonly="1" name="invoice_am_ids" nolabel="1" mode="tree"/>
            <separator colspan="4" string="Cost Invoices Journal Entries"/>
            <field colspan="4" readonly="1" name="invoice_cost_am_ids" nolabel="1" mode="tree"/>
            <separator colspan="4" string="Pickings Journal Entries"/>
            <field colspan="4" readonly="1" name="picking_am_ids" nolabel="1" mode="tree"/>
            <separator colspan="4" string="Landed Costs Journal Entries"/>
            <field colspan="4" readonly="1" name="landed_cost_am_ids" nolabel="1" mode="tree"/>
          </page>
        </xpath>

      </field>
    </record>

    <!-- TO DO: had to inherit custom view to xpath and extend options' attributes to colorize fields -->
    <!-- optimally this should be added in primary view -->
    <!-- but the JSON syntax doesn't bode well with conditions against field 'values' -->
    <record id="view_invoice_tree_inherit" model="ir.ui.view">
      <field name="name">invoice.tree.inherit.gard_order_history</field>
      <field name="model">account.invoice</field>
      <field name="mode">extension</field>
      <field name="inherit_id" ref="gard_order_history.view_invoice_tree"/>
      <field name="arch" type="xml">

        <xpath expr="//tree/field[@name='estado_fac']" position="attributes">
          <attribute name="options">{ "bg_color": " silver: state in 'paid' and estado_fac in 'A'; lightcoral: state not in ('paid','cancel') and estado_fac in 'A' " }</attribute>
        </xpath>

        <xpath expr="//tree/field[@name='residual_signed']" position="attributes">
          <attribute name="options">{ "bg_color": " lightcoral: (state in 'open') and (residual_signed &gt; 0) and (date_due &lt; current_date) " }</attribute>
        </xpath>

      </field>
    </record>

  </data>
</openerp>

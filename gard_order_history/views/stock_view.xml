<?xml version="1.0"?>
<openerp>
    <data>

        <record id="vpicktree" model="ir.ui.view">
            <field name="name">vpicktree.inherit.gard_order_history</field>
            <field name="model">stock.picking</field>
            <field name="mode">extension</field>
            <field name="inherit_id" ref="stock.vpicktree"/>
            <field name="arch" type="xml">

                <xpath expr="//tree" position="replace">
                    <tree decoration-info="state == 'draft'" decoration-muted="state == 'cancel'" decoration-danger="state not in ('cancel', 'done') and scheduled_date &lt; current_date" string="Picking list">
                        <field name="state" widget="label_selection"
                            options="{
                                'classes': {
                                    'draft': 'primary',
                                    'waiting': 'warning',
                                    'confirmed': 'warning',
                                    'assigned': 'warning',
                                    'done': 'success',
                                    'cancel': 'default'
                                    }}"/>
                        <field name="scheduled_date"/>
                        <field name="date_done"/>
                        <field name="name"/>
                        <field name="group_id"/>
                        <field name="origin"/>
                        <field name="partner_id"/>
                        <field name="partner_consign"/>
                        <field name="location_id"/>
                        <field name="location_dest_id"/>
                        <field name="backorder_id"/>
                        <field name="create_uid"/>
                        <field invisible="1" name="create_date"/>
                        <field name="priority" invisible="1"/>
                        <field name="picking_type_id" invisible="1"/>
                    </tree>
                </xpath>

                <xpath expr="//tree/field[@name='scheduled_date']" position="attributes">
                    <attribute name="options">{
                        "bg_color": "
                            lightcoral: state not in ('cancel', 'done') and scheduled_date &lt; current_date
                            "
                    }</attribute>
                </xpath>

            </field>
        </record>

        <record id="view_stock_picking_tree" model="ir.ui.view">
            <field name="name">stock.picking.tree.gard_order_history</field>
            <field name="model">stock.picking</field>
            <field name="view_mode">tree</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">

                <tree decoration-info="state == 'draft'" decoration-muted="state == 'cancel'" decoration-danger="state not in ('cancel', 'done') and scheduled_date &lt; current_date">
                    <field name="state" widget="label_selection"
                        options="{
                            'classes': {
                                'draft': 'primary',
                                'waiting': 'warning',
                                'confirmed': 'warning',
                                'assigned': 'warning',
                                'done': 'success',
                                'cancel': 'default'
                                }}"/>
                    <field name="scheduled_date"/>
                    <field name="date_done"/>
                    <field name="name"/>
                    <field name="origin"/>
                    <field name="partner_id"/>
                    <field name="partner_consign"/>
                    <field name="location_id"/>
                    <field name="location_dest_id"/>
                </tree>

            </field>
        </record>

        <!-- TO DO: had to inherit custom view to xpath and extend options' attributes to colorize fields -->
        <!-- optimally this should be added in primary view -->
        <!-- but the JSON syntax doesn't bode well with conditions against field values -->
        <record id="view_stock_picking_tree_inherit" model="ir.ui.view">
            <field name="name">stock.picking.tree.inherit.gard_order_history</field>
            <field name="model">stock.picking</field>
            <field name="mode">extension</field>
            <field name="inherit_id" ref="gard_order_history.view_stock_picking_tree"/>
            <field name="arch" type="xml">

                <xpath expr="//tree/field[@name='scheduled_date']" position="attributes">
                    <attribute name="options">{
                        "bg_color": "
                            lightcoral: state not in ('cancel', 'done') and scheduled_date &lt; current_date
                            "
                    }</attribute>
                </xpath>

            </field>
        </record>

    </data>
</openerp>

<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>

    <!-- View Customizations -->
    <record id="view_order_form" model="ir.ui.view">
      <field name="name">view.order.form.inherit.gard_product_price</field>
      <field name="model">sale.order</field>
      <field name="mode">extension</field>
      <field name="priority">19</field>
      <field name="inherit_id" ref="sale.view_order_form" />
      <field name="arch" type="xml">

        <!-- mod product_id context pricelist value -->
        <xpath expr="//field[@name='order_line']/tree/field[@name='product_id']" position="attributes">
          <attribute name="context">{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':pricelist_id, 'uom':product_uom, 'company_id': parent.company_id}</attribute>
        </xpath>

        <!-- add domain to product_uom -->
        <xpath expr="//field[@name='order_line']/tree//field[@name='product_uom']"
          position="before">
          <field name="product_uom_ids" invisible="1" />
        </xpath>
        <xpath expr="//field[@name='order_line']/tree//field[@name='product_uom']"
          position="attributes">
          <attribute name="domain">[('id', 'in', product_uom_ids)]</attribute>
        </xpath>

        <!-- move and pricelist -->
        <xpath expr="//field[@name='order_line']/tree/field[@name='price_unit']"
          position="before">
          <!-- product pricelist items button -->
          <button
            name="button_product_pricelist_items"
            type='object'
            attrs="{'invisible':[('pricelist_item_count', '=', 0)]}"
            icon="fa-tags fa-gard-icon-orange fa-2x"
            string="Pricelist Items" />
          <!-- so line pricelist_id -->
          <field name="pricelist_id" />
          <field name="pricelist_item_count" invisible="1" />
        </xpath>
        <xpath expr="//field[@name='order_line']/form//field[@name='price_unit']"
          position="before">
          <!-- product pricelist items button -->
          <button
            name="button_product_pricelist_items"
            type='object'
            attrs="{'invisible':[('pricelist_item_count', '=', 0)]}"
            icon="fa-tags fa-gard-icon-orange fa"
            string="Pricelist Items" />
          <!-- so line pricelist_id -->
          <field name="pricelist_id" />
          <field name="pricelist_item_count" invisible="1" />
        </xpath>
        <!-- <xpath expr="/form//field[@name='order_line']/kanban/templates/t//div" position="inside">
          <div class="row">
            <button
              name="button_product_pricelist_items"
              type='object'
              attrs="{'invisible':[('pricelist_item_count', '=', 0)]}"
              class="fa-tags fa-gard-icon-orange fa"
              string="Pricelist Items" />
          </div>
          <field name="pricelist_id" />
          <field name="pricelist_item_count" invisible="1" />
        </xpath> -->

      </field>
    </record>

    <record model="ir.ui.view" id="view_order_line_tree">
      <field name="name">sale.order.line.tree.inherit.gard_product_price</field>
      <field name="model">sale.order.line</field>
      <field name="mode">extension</field>
      <field name="priority">19</field>
      <field name="inherit_id" ref="sale.view_order_line_tree" />
      <field name="arch" type="xml">

        <xpath expr="//field[@name='price_unit']" position="before">
          <button
            name="button_product_pricelist_items"
            type='object'
            attrs="{'invisible':[('pricelist_item_count', '=', 0)]}"
            icon="fa-tags fa-gard-icon-orange fa-2x"
            string="Pricelist Items" />
          <field name="pricelist_id" />
          <field name="pricelist_item_count" invisible="1" />
        </xpath>
        
      </field>
    </record>

    <!-- Menus -->
    <menuitem
      id="menu_product_pricelist_main"
      groups="gard_product_price.group_product_price_manager" />

    <menuitem
      id="product_pricelist_item_menu_action"
      name="Pricelist Items"
      parent="sale.product_menu_catalog"
      action="product_pricelist_item_action_view_tree"
      groups="gard_product_price.group_product_price_manager"
      sequence="20" />

    <!-- unsued for now: triggered by base_import do method -->
    <!-- <menuitem
        id="product_pricelist_item_recompute_menu_action"
        name="Recompute Pricelist Items"
        parent="sale.product_menu_catalog"
        action="product_pricelist_item_action_view_tree"
        groups="gard_product_price.group_product_price_manager"
        sequence="20"/> -->

  </data>
</odoo>
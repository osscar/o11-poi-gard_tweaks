<?xml version="1.0"?>
<odoo>

    <!-- View Customizations -->
    <record id="view_order_form" model="ir.ui.view">
        <field name="name">view.order.form.inherit.gard_product_price</field>
        <field name="model">sale.order</field>
        <field name="mode">extension</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">

            <!-- move and add pricelist propagator -->
            <xpath expr="//field[@name='pricelist_id']" position="replace"></xpath>
            <xpath expr="//field[@name='order_line']" position="before">
                <group name="line_options">
                    <field name="pricelist_id" attrs="{'invisible': [('state', '!=', 'draft')]}" options="{'no_create_edit': True}"/>
                </group>
            </xpath>
            <xpath expr="/form//field[@name='order_line']/tree/field[@name='price_unit']" position="after">
                <!-- so line pricelist_id -->
                <field name="pricelist_id"/>
                <field name="pricelist_item_count" invisible="1"/>
                <!-- product pricelist items button -->
                <button
                    name="button_product_pricelist_items"
                    type='object'
                    attrs="{'invisible':[('pricelist_item_count', '=', 0)]}"
                    icon="fa fa-2x fa-tags fa-gard-icon-orange"
                    string="Pricelist Items"/>
            </xpath>
            <xpath expr="//kanban" position="inside">
                <!-- so line pricelist_id -->
                <field name="pricelist_id"/>
                <field name="pricelist_item_count" invisible="1"/>
            </xpath>
            <xpath expr="/form//field[@name='order_line']/kanban/templates/t//div" position="inside">
                    <div class="row">
                        <button
                            name="button_product_pricelist_items"
                            type='object'
                            attrs="{'invisible':[('pricelist_item_count', '=', 0)]}"
                            class="fa fa-2x fa-tags fa-gard-icon-orange pull-right"
                            string="Pricelist Items"/>
                    </div>
            </xpath>

        </field>
    </record>

    <!-- Actions -->
    <!-- unsued for now: triggered by base_import do method -->
    <!-- call pricelist item calc_unit_price method to recompute ALL pricelist items -->
    <!-- <record id="category_python_action" model="ir.actions.server">
        <field name="name">Recompute Pricelist Items</field>
        <field name="model_id" ref="product.model_product_pricelist_items"/>
        <field name="state">code</field>
        <field name="code">
            action = model._calc_unit_price()
        </field>
    </record> -->

    <!-- Menus -->
    <menuitem
        id="menu_product_pricelist_main"
        groups="gard_product_price.group_product_price_manager"/>

    <menuitem
        id="product_pricelist_item_menu_action"
        name="Pricelist Items"
        parent="sale.product_menu_catalog"
        action="product_pricelist_item_action_view_tree"
        groups="gard_product_price.group_product_price_manager"
        sequence="20"/>

        <!-- unsued for now: triggered by base_import do method -->
        <!-- <menuitem
        id="product_pricelist_item_recompute_menu_action"
        name="Recompute Pricelist Items"
        parent="sale.product_menu_catalog"
        action="product_pricelist_item_action_view_tree"
        groups="gard_product_price.group_product_price_manager"
        sequence="20"/> -->

</odoo>
